#the name of the output file (withoud .exe)

PROG = main
# the needed cpp files (withoud .cpp)
MODULES := main shapedetector

# the deps directory
DEPS_DIR_WIN:= ..\..\deps
DEPS_DIR_LINUX:= ../../deps
CFLAGS = -std=c++11 
 
HEADER := $(patsubst %,%.h,$(MODULES  ))

OBJECTS := $(patsubst %,%.o,$(MODULES))

ifeq ($(OS),Windows_NT)
	gcc = g++
	LINKFLAGS = -I$(DEPS_DIR_WIN)"\files\opencv" -L$(DEPS_DIR_WIN)"\libs\opencv\windows\x86"  -lopencv_core2410 -lopencv_highgui2410 -lopencv_imgproc2410 -lopencv_contrib2410 -lopencv_calib3d2410d -lopencv_features2d2410d -lopencv_flann2410d -lopencv_gpu2410d -lopencv_legacy2410d -lopencv_ml2410d -Wl,-rpath=$(DEPS_DIR_WIN)"\bin"
	rm = del
	TARGET := $(PROG).exe

else
	ARCH := $(shell getconf LONG_BIT)
	CPP_FLAGS_32 := $(DEPS_DIR_LINUX)/libs/Linux/x86	
	CPP_FLAGS_64 := $(DEPS_DIR_LINUX)/libs/Linux/x64
	LINKFLAGS := -L$(CPP_FLAGS_$(ARCH)) -lopencv_core -lopencv_highgui -lopencv_imgproc -Wl,-rpath=$(CPP_FLAGS_$(ARCH))	
	gcc := /usr/bin/g++
	rm := rm -f
	TARGET := $(PROG)
endif
.PHONY: build clean

build: $(TARGET) 

clean:		
	$(rm) $(TARGET) $(OBJECTS)

$(TARGET): $(OBJECTS)
	$(gcc) -o $@ $(OBJECTS) $(LINKFLAGS)

$(OBJECTS): %.o : $(HEADERS) %.cpp
	$(gcc) -c  -o  $@  $< $(CFLAGS)